## 基本需求分析
### 操作回滚
先写入文件，再写入元数据。
如果失败了要删除对应的文件,且不写入元数据

### 虚拟路径的写入

### 文件上传接口的日志审计

需要记录下列信息

1. 系统响应结果：
   HTTP状态码。
2. 用户身份信息：
   用户ID或用户名，以识别执行上传操作的用户。
   用户的IP地址和设备信息（如果可用），用于审计和安全分析。
3. 文件信息：
   上传的文件名和类型。
   文件大小。
   文件的哈希值或摘要，用于验证完整性。
4. 操作详情：
   时间戳：记录每个操作发生的确切时间，包括日期和时间。
   上传成功或失败的状态。
   如果失败，记录失败的原因（例如，文件太大、格式不支持等）。

### 权限管理

- **由中间件实现**：
    - 使用中间件来处理身份验证和授权。
    - 确保只有具有相应权限的用户可以上传、查看或修改文件。
- [具体设计](../token/design.md)

### 安全性

### 文件接收

#### 文件重复逻辑判断

- **实现机制**：
    - 利用哈希值或其他唯一标识符来识别重复文件。
    - 提供用户选项，如自动重命名、覆盖或拒绝重复文件。

#### 大小判定

- **限制和优化**：
    - 设定文件大小上限，防止过大文件影响系统性能。
    - 对大文件上传提供分块上传或压缩机制。

#### 文件格式识别

- **安全和兼容性**：
    - 识别和验证文件格式，确保上传的文件符合系统要求。
    - 防止不支持或可能危险的文件格式上传。

### 文件存储

#### 文件数据流向

- **直接存储 vs 缓存系统**：
    - 考虑直接上传到最终存储还是先存于缓存系统，再异步传输到存储系统。
    - 评估性能影响和数据安全性。
    - **异步处理**：
    - 对于大型文件或高负载情况，考虑使用异步处理来优化性能。

#### 元数据管理

- **存储和使用**：
    - 收集和存储文件相关的元数据，如上传者信息、上传时间、文件大小等。
    - 利用元数据进行文件管理，如分类、搜索和报告。

## 进阶功能

### 1.断点续传

### 2.压缩传输

需要双端支持，用中间件实现

## 实现方案

- [x] [基本功能](upload.go)
- [ ] [权限管理](../token)
- [ ] 文件上传时的安全性
- [ ] 文件接收
    - [ ] 文件重复逻辑判断
    - [x] [middleware-文件大小判定](../../../middleware/files/sizeLimit/design.md)
    - [ ] middleware-文件格式识别
    - [ ] 文件数据流向
        - [ ] [直接存储](store_direct.go)
        - [ ] 缓存系统
- [ ] 文件存储
- [x] [日志审计](../auditLogging)
- [ ] 断点续传
- [ ] 压缩传输
- [ ]